# Todos
#
# - Add examples
openapi: 3.0.3

###################################################################
# General                                                         #
###################################################################
info:
  version: 2.0.0
  title: Corbado Frontend API
  description: Overview of all Corbado Frontend API calls to implement passwordless authentication.
  contact:
    name: Corbado team
    email: support@corbado.com
    url: https://www.corbado.com

servers:
  - url: https://<project ID>.frontendapi.corbado.io

tags:
  - name: Auth
    description: All API calls that are related to an authentication process.

paths:
  /v2/component-config:
    post:
      description: tbd
      operationId: UpdateComponentConfig
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/updateComponentConfigReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/updateComponentConfigRsp'

  /v2/me/passkeys:
    get:
      description: Gets current user's passkeys
      operationId: CurrentUserPasskeyGet
      tags:
        - Users
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/mePasskeyRsp'

  /v2/me/passkeys/append/start:
    post:
      description: Start passkey append
      operationId: CurrentUserPasskeyAppendStart
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/passkeyAppendStartReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/mePasskeyAppendStartRsp'

  /v2/me/passkeys/append/finish:
    post:
      description: Finish passkey append
      operationId: CurrentUserPasskeyAppendFinish
      tags:
        - Users
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/passkeyAppendFinishReq'
      responses:
        '204':
          description: tbd

  /v2/me/passkeys/{credentialID}:
    delete:
      description: Delete current user's passkeys
      operationId: CurrentUserPasskeyDelete
      parameters:
        - in: path
          required: true
          name: credentialID
          schema:
            type: string
          description: 'Credential ID from passkeys'
          example: 'cre-abc123'
      tags:
        - Users
      responses:
        '200':
          description: tbs
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/mePasskeyDeleteRsp'

  /v2/me/refresh:
    put:
      description: Performs session refresh
      operationId: CurrentUserSessionRefresh
      tags:
        - Users
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/authenticationResponse'

  /v2/me/logout:
    post:
      description: Performs session logout
      operationId: CurrentUserSessionLogout
      tags:
        - Users
      responses:
        '204':
          description: tbd

  /v2/auth/process/init:
    post:
      description: tbd
      operationId: ProcessInit
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/processInitReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/processInitRsp'

  /v2/auth/process:
    get:
      description: tbd
      operationId: ProcessGet
      tags:
        - Auth
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/blockBody'

  /v2/auth/process/complete:
    post:
      description: tbd
      operationId: ProcessComplete
      tags:
        - Auth
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/blockBody'

  /v2/auth/signup/init:
    post:
      description: tbd
      operationId: SignupInit
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/signupInitReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/signupInitRsp'

  /v2/auth/login/init:
    post:
      description: tbd
      operationId: LoginInit
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/loginInitReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/loginInitRsp'

  /v2/auth/block/skip:
    post:
      description: tbd
      operationId: BlockSkip
      tags:
        - Auth
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/blockBody'

  /v2/auth/passkey/append/start:
    post:
      description: tbd
      operationId: PasskeyAppendStart
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/passkeyAppendStartReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/passkeyAppendStartRsp'

  /v2/auth/passkey/append/finish:
    post:
      description: tbd
      operationId: PasskeyAppendFinish
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/passkeyAppendFinishReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/passkeyAppendFinishRsp'

  /v2/auth/passkey/login/start:
    post:
      description: tbd
      operationId: PasskeyLoginStart
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/passkeyLoginStartReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/passkeyLoginStartRsp'

  /v2/auth/passkey/login/finish:
    post:
      description: tbd
      operationId: PasskeyLoginFinish
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/passkeyLoginFinishReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/passkeyLoginFinishRsp'

  /v2/auth/email/verify/start:
    post:
      description: tbd
      operationId: EmailVerifyStart
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/emailVerifyStartReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/emailVerifyStartRsp'

  /v2/auth/email/verify/finish:
    post:
      description: tbd
      operationId: EmailVerifyFinish
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/emailVerifyFinishReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/emailVerifyFinishRsp'

  /v2/auth/phone/verify/start:
    post:
      description: tbd
      operationId: PhoneVerifyStart
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/phoneVerifyStartReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/phoneVerifyStartRsp'

  /v2/auth/phone/verify/finish:
    post:
      description: tbd
      operationId: PhoneVerifyFinish
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/phoneVerifyFinishReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/phoneVerifyFinishRsp'

  /v2/auth/social/verify/start:
    post:
      description: tbd
      operationId: SocialVerifyStart
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/socialVerifyStartReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/socialVerifyStartRsp'

  /v2/auth/social/verify/finish:
    post:
      description: tbd
      operationId: SocialVerifyFinish
      tags:
        - Auth
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/socialVerifyFinishRsp'

  /v2/auth/phone/collect:
    post:
      description: tbd
      operationId: PhoneCollect
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/phoneCollectReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/phoneCollectRsp'

  /v2/auth/username/collect:
    post:
      description: tbd
      operationId: UsernameCollect
      tags:
        - Auth
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/usernameCollectReq'
      responses:
        '200':
          description: tbd
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/usernameCollectRsp'

components:
  ###################################################################
  # Security schemes                                                #
  ###################################################################
  securitySchemes:
    basicAuth:
      type: http
      scheme: basic
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
    projectID:
      in: header
      name: X-Corbado-ProjectID
      type: apiKey

  schemas:
    updateComponentConfigReq:
      type: object
      description: tbd.
      required:
        - identifiers
      properties:
        identifiers:
          type: array
          items:
            $ref: '#/components/schemas/loginIdentifierConfig'

    updateComponentConfigRsp:
      type: object
      properties:
        success:
          type: boolean

    processInitReq:
      type: object
      description: tbd.
      required:
        - clientInfo
      properties:
        clientInfo:
          type: object

    processInitRsp:
      type: object
      description: tbd.
      required:
        - token
        - expiresAt
        - initialBlock
      properties:
        token:
          type: string
        expiresAt:
          type: integer
        initialBlock:
          $ref: '#/components/schemas/blockBody'

    signupInitReq:
      type: object
      description: tbd.
      required:
        - identifiers
      properties:
        fullName:
          type: string
        identifiers:
          type: array
          items:
            $ref: '#/components/schemas/loginIdentifier'

    signupInitRsp:
      $ref: '#/components/schemas/blockBody'

    loginInitReq:
      type: object
      description: tbd.
      required:
        - identifierValue
        - isPhone
      properties:
        identifierValue:
          type: string
        isPhone:
          type: boolean


    loginInitRsp:
      $ref: '#/components/schemas/blockBody'

    passkeyAppendStartReq:
      type: object
      description: tbd.
      required:
        - clientInfo
      properties:
        clientInfo:
          type: object

    passkeyAppendStartRsp:
      $ref: '#/components/schemas/blockBody'

    mePasskeyAppendStartRsp:
      type: object
      required:
        - challenge
      properties:
        challenge:
          type: string

    passkeyAppendFinishReq:
      type: object
      description: tbd.
      required:
        - clientInfo
        - signedChallenge
      properties:
        clientInfo:
          type: object
        signedChallenge:
          type: string

    passkeyAppendFinishRsp:
      $ref: '#/components/schemas/blockBody'

    passkeyLoginStartReq:
      type: object
      description: tbd.
      required:
        - clientInfo
      properties:
        clientInfo:
          type: object

    passkeyLoginStartRsp:
      $ref: '#/components/schemas/blockBody'

    passkeyLoginFinishReq:
      type: object
      description: tbd.
      required:
        - clientInfo
        - signedChallenge
      properties:
        clientInfo:
          type: object
        signedChallenge:
          type: string

    passkeyLoginFinishRsp:
      $ref: '#/components/schemas/blockBody'

    emailVerifyStartReq:
      type: object
      description: tbd.
      required:
        - verificationType
      properties:
        verificationType:
          $ref: '#/components/schemas/verificationMethod'

    emailVerifyStartRsp:
      $ref: '#/components/schemas/blockBody'

    emailVerifyFinishReq:
      type: object
      required:
        - clientInfo
        - code
        - verificationType
      properties:
        clientInfo:
          type: object
        code:
          type: string
        verificationType:
          $ref: '#/components/schemas/verificationMethod'

    emailVerifyFinishRsp:
      $ref: '#/components/schemas/blockBody'

    phoneVerifyStartReq:
      type: object
      description: tbd.
      required:
        - clientInfo
      properties:
        clientInfo:
          type: object

    phoneVerifyStartRsp:
      $ref: '#/components/schemas/blockBody'

    phoneVerifyFinishReq:
      type: object
      required:
        - clientInfo
        - code
      properties:
        clientInfo:
          type: object
        code:
          type: string

    phoneVerifyFinishRsp:
      $ref: '#/components/schemas/blockBody'

    usernameCollectReq:
      type: object
      required:
        - clientInfo
        - value
      properties:
        clientInfo:
          type: object
        value:
          type: string

    usernameCollectRsp:
      $ref: '#/components/schemas/blockBody'

    phoneCollectReq:
      type: object
      required:
        - clientInfo
        - value
      properties:
        clientInfo:
          type: object
        value:
          type: string

    phoneCollectRsp:
      $ref: '#/components/schemas/blockBody'

    socialVerifyStartReq:
      type: object
      required:
        - clientInfo
      properties:
        clientInfo:
          type: object

    socialVerifyStartRsp:
      $ref: '#/components/schemas/blockBody'

    socialVerifyFinishRsp:
      $ref: '#/components/schemas/blockBody'

    verifyPasskeyRsp:
      type: object
      required:
        - primary
        - alternatives
      properties:
        primary:
          type: object
        alternatives:
          type: object

    verifyIdentifierRsp:
      type: object
      required:
        - primary
        - alternatives
      properties:
        primary:
          type: object
        alternatives:
          type: object

    mePasskeyRsp:
      type: object
      required:
        - passkeys
      properties:
        passkeys:
          type: array
          items:
            $ref: '#/components/schemas/passKeyItem'
        paging:
          $ref: 'common.yml#/components/schemas/paging'


    mePasskeyDeleteRsp:
      type: object
      required:
        - id
      properties:
        id:
          type: string

    passKeyItem:
      type: object
      required:
        - id
        - credentialHash
        - aaguid
        - userAgent
        - attestationType
        - transport
        - backupEligible
        - backupState
        - lastUsed
        - status
        - created
      properties:
        id:
          type: string
        credentialHash:
          type: string
        aaguid:
          type: string
        userAgent:
          type: string
        attestationType:
          type: string
        transport:
          type: array
          items:
            type: string
        backupEligible:
          type: boolean
        backupState:
          type: boolean
        lastUsed:
          type: string
          description: Timestamp of when the entity was last used in yyyy-MM-dd'T'HH:mm:ss format
        status:
          type: string
          enum: [ 'pending', 'active' ]
          description: "Status"
        created:
          $ref: 'common.yml#/components/schemas/created'

    loginIdentifierConfig:
      type: object
      required:
        - type
        - enforceVerification
        - useAsLoginIdentifier
      properties:
        type:
          $ref: '#/components/schemas/loginIdentifierType'
        enforceVerification:
          type: string
          enum: [ none, signup, before-passkey-login ]
        useAsLoginIdentifier:
          type: boolean
        metadata:
          type: object

    blockBody:
      type: object
      required:
        - block
        - data
        - authType
      properties:
        block:
          $ref: '#/components/schemas/blockType'
        authType:
          $ref: '#/components/schemas/authType'
        data:
          type: object
          anyOf:
            - $ref: '#/components/schemas/generalBlockPasskeyAppend'
            - $ref: '#/components/schemas/generalBlockPasskeyVerify'
            - $ref: '#/components/schemas/generalBlockVerifyIdentifier'
            - $ref: '#/components/schemas/generalBlockPasskeyAppended'
            - $ref: '#/components/schemas/generalBlockCompleted'
            - $ref: '#/components/schemas/generalBlockSignupInit'
            - $ref: '#/components/schemas/generalBlockSocialVerify'
            - $ref: '#/components/schemas/generalBlockUsernameCollect'
            - $ref: '#/components/schemas/generalPhoneCollect'
            - $ref: '#/components/schemas/generalBlockLoginInit'
        alternatives:
          type: array
          items:
            $ref: '#/components/schemas/blockBody'
        error:
          $ref: '#/components/schemas/requestError'

    loginIdentifier:
      type: object
      required:
        - type
        - identifier
      properties:
        type:
          $ref: '#/components/schemas/loginIdentifierType'
        identifier:
          type: string

    loginIdentifierWithError:
      type: object
      required:
        - type
        - identifier
      properties:
        type:
          $ref: '#/components/schemas/loginIdentifierType'
        identifier:
          type: string
        error:
          $ref: '#/components/schemas/requestError'

    loginIdentifierType:
      type: string
      enum: [ email, phone, username ]

    blockType:
      type: string
      enum: [ signup-init, passkey-append, phone-verify, email-verify, passkey-appended, completed, social-verify, username-collect, phone-collect, login-init, passkey-verify ]

    authType:
      type: string
      enum: [ signup, login ]

    verificationMethod:
      type: string
      enum: [ email-link, email-otp, sms-otp ]

    generalBlockSignupInit:
      type: object
      required:
        - identifiers
      properties:
        identifiers:
          type: array
          items:
            $ref: '#/components/schemas/loginIdentifierWithError'
        fullName:
          type: object
          required:
            - value
          properties:
            value:
              type: string
            error:
              $ref: '#/components/schemas/requestError'

    generalBlockLoginInit:
      type: object
      required:
        - identifiers
      properties:
        identifiers:
          type: array
          items:
            $ref: '#/components/schemas/loginIdentifierWithError'

    generalBlockSocialVerify:
      type: object

    generalBlockUsernameCollect:
      $ref: '#/components/schemas/loginIdentifierWithError'

    generalPhoneCollect:
      $ref: '#/components/schemas/loginIdentifierWithError'

    generalBlockPasskeyAppend:
      type: object
      required:
        - challenge
        - userHandle
      properties:
        challenge:
          type: string
        userHandle:
          type: string

    generalBlockPasskeyVerify:
      type: object
      required:
        - challenge
      properties:
        challenge:
          type: string

    generalBlockPasskeyAppended:
      type: object

    generalBlockCompleted:
      $ref: '#/components/schemas/authenticationResponse'

    generalBlockVerifyIdentifier:
      type: object
      required:
        - verificationMethod
        - identifier
        - alternativeVerificationMethods
      properties:
        verificationMethod:
          $ref: '#/components/schemas/verificationMethod'
        identifier:
          type: string
        retryNotBefore:
          type: integer
          format: int32
        error:
          $ref: '#/components/schemas/requestError'
        alternativeVerificationMethods:
          type: array
          items:
            type: object
          required:
            - verificationMethod
            - identifier
          properties:
            verificationMethod:
              $ref: '#/components/schemas/verificationMethod'
            identifier:
              type: string

    authenticationResponse:
      type: object
      required:
        - shortSession
      properties:
        longSession:
          type: string
          description: Only given when project environment is dev
        shortSession:
          type: string


    requestError:
      type: object
      required:
        - code
        - message
      properties:
        code:
          type: string
        message:
          type: string

security:
  - bearerAuth: [ ]
  - projectID: [ ]
